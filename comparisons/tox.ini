[tox]
envlist=dnaio,pyfastx,fastq-and-furious
skip_install=true
skipsdist=True

[testenv]
allowlist_externals=
    hyperfine

[testenv:dnaio]
deps =
    dnaio
commands =
    hyperfine -L file single43bp,paired150bp_1,paired300bp_1,single9000bp -w 3 -r 10 'python dnaio/read.py ../data/\{file\}.fastq'
    hyperfine -L file single43bp,paired150bp_1,paired300bp_1,single9000bp -w 3 -r 10 'python dnaio/read.py ../data/\{file\}.fastq.gz'
    hyperfine -L file single43bp,paired150bp_1,paired300bp_1,single9000bp -w 3 -r 10 'python dnaio/read_and_write.py ../data/\{file\}.fastq /dev/null'
    hyperfine -L file paired150bp,paired300bp -w 3 -r 10 'python dnaio/read_paired.py ../data/\{file\}_1.fastq ../data/\{file\}_2.fastq'

[testenv:pyfastx]
deps =
    pyfastx
commands =
    hyperfine -L file single43bp,paired150bp_1,paired300bp_1,single9000bp -w 3 -r 10 'python pyfastx/read.py ../data/\{file\}.fastq'
    hyperfine -L file single43bp,paired150bp_1,paired300bp_1,single9000bp -w 3 -r 10 'python pyfastx/read.py ../data/\{file\}.fastq.gz'
    hyperfine -L file single43bp,paired150bp_1,paired300bp_1,single9000bp -w 3 -r 10 'python pyfastx/read_and_write.py ../data/\{file\}.fastq /dev/null'

[testenv:fastq-and-furious]
deps =
    fastq-and-furious
commands =
    hyperfine -L file single43bp,paired150bp_1,paired300bp_1,single9000bp -w 3 -r 10 'python fastq-and-furious/read.py ../data/\{file\}.fastq'
    hyperfine -L file single43bp,paired150bp_1,paired300bp_1,single9000bp -w 3 -r 10 'python fastq-and-furious/read.py ../data/\{file\}.fastq.gz'

[testenv:fastp]
allowlist_externals=
    git
    rm
    make
    bash
    hyperfine
passenv=
    CONDA_PREFIX
commands=
    git submodule update --init --recursive
    rm -f fastp/fastp/src/main.cpp  # We replace the main function
    bash -c 'LIBRARY_DIRS=$CONDA_PREFIX/lib INCLUDE_DIRS=$CONDA_PREFIX/include make -s -j -C fastp'
    hyperfine -L file single43bp,paired150bp_1,paired300bp_1,single9000bp -w 3 -r 10 './fastp/read_program ../data/\{file\}.fastq'
    hyperfine -L file single43bp,paired150bp_1,paired300bp_1,single9000bp -w 3 -r 10 './fastp/read_program ../data/\{file\}.fastq.gz'
    hyperfine -L file single43bp,paired150bp_1,paired300bp_1,single9000bp -w 3 -r 10 './fastp/read_and_write_program ../data/\{file\}.fastq /dev/null'
    hyperfine -L file paired150bp,paired300bp -w 3 -r 10 './fastp/read_paired_program ../data/\{file\}_1.fastq ../data/\{file\}_2.fastq'

[testenv:scikit-bio]
deps =
    scipy==1.8.1
    scikit-bio==0.5.7
commands=
    hyperfine -L file single43bp,paired150bp_1,paired300bp_1,single9000bp -w 3 -r 10 'python ./scikit-bio/read.py ../data/\{file\}.fastq'

[testenv:all]
allowlist_externals=
    git
    rm
    make
    bash
    hyperfine
deps=
    dnaio
    pyfastx
    fastq-and-furious
passenv=
    CONDA_PREFIX
commands=
    git submodule update --init --recursive
    rm -f fastp/fastp/src/main.cpp  # We replace the main function
    bash -c 'LIBRARY_DIRS=$CONDA_PREFIX/lib INCLUDE_DIRS=$CONDA_PREFIX/include make -j -C fastp'
    hyperfine -L program dnaio,fastp,pyfastx,fastq-and-furious -w 3 -r 10 './\{program\}/read.py ../data/single43bp.fastq'
    hyperfine -L program dnaio,fastp,pyfastx,fastq-and-furious -w 3 -r 10 './\{program\}/read.py ../data/paired150bp_1.fastq'
